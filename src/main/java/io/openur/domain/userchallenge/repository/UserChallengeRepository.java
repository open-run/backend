package io.openur.domain.userchallenge.repository;

import io.openur.domain.userchallenge.model.UserChallenge;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.transaction.annotation.Transactional;

public interface UserChallengeRepository {

    UserChallenge save(UserChallenge userChallenge);

    @Transactional
    void bulkInsertUserChallenges(List<UserChallenge> userChallenges);

    /**
     * Increments the currentCount for challenges of type COUNT
     * @param userChallengeIds List of user challenge IDs to update
     */
    void bulkIncrementCount(List<Long> userChallengeIds);

    /**
     * Updates completion status after NFT airdrop
     * @param completedChallenges List of challenges that have been completed and had NFT airdropped
     */
    void bulkUpdateCompletedChallenges(List<Long> completedUserChallengeIds);

    Page<UserChallenge> findUncompletedChallengesByUserId(
        String userId, Pageable pageable
    );

    Page<UserChallenge> findCompletedChallengesByUserId(
        String userId, Pageable pageable
    );

    Page<UserChallenge> findRepetitiveChallengesByUserId(
        String userId, Pageable pageable
    );

    Map<Long, UserChallenge> findRepetitiveUserChallengesMappedByStageId(
        String userId, Long challengeId
    );

    Optional<UserChallenge> findFirstBySimpleRepetitiveChallenge(String userId);

    void delete(UserChallenge userChallenge);
} 
